# Google Calendar Peering (GAS Edition)

仕事（Work）と家庭（Home）、2つの独立したGoogleカレンダーを相互接続（Peering）し、最適なワークライフバランスを実現するGoogle Apps Script (GAS) ツールです。
サーバー不要、完全無料で動作し、プライバシーに配慮した設計になっています。

## 🎯 コンセプト - Why "Peering"?

本ツールが「Sync（同期）」ではなく *「Peering（ピアリング）」* を名乗るのには理由があります。

インターネットにおけるピアリングが「異なるネットワーク同士が必要な経路情報のみを交換する」ように、このツールは **仕事と家庭という異なる領域（ドメイン）の独立性を保ったまま、必要な「空き時間」と「予定」のみを相互に広報（Advertise）します。**

単なるデータの複製（ミラーリング）ではなく、互いの領域を尊重するロジックでワークライフバランスを支援します。

* **Work domain → Home domain:**
    * **広報内容:** 家族との時間が確保できる「休日・祝日」の情報。
    * **目的:** 仕事の予定で埋まりがちなカレンダーの中に、家族と過ごせる「空白」を明確化します。

* **Home domain → Work domain:**
    * **広報内容:** 平日の通院や役所手続きなど、どうしても外せない「私用（マスク対象）」の情報。
    * **目的:** 具体的な内容は隠蔽（Mask）したまま「休暇」として共有し、職場からの会議設定を防ぎつつプライバシーを保護します。

## 🚀 特徴

* **完全無料 & サーバーレス:** Google Apps Script (GAS) だけで完結し、常時稼働サーバーは不要です。
* **Work -> Home (自動共有):** 休日・祝日の仕事予定を、自動で家庭カレンダーへ連携します。
* **Home -> Work (マスク共有):** 平日の私用を、仕事カレンダーへ「休暇」として内容をマスクして共有します。内容は表示されませんのでプライバシーを保護します。
* **タグによる手動制御:** `[Home]` / `[Work]` タグで、自動判定に関わらず同期対象を指定できます。
* **通知対応:** Discord / Google Chat へ変更ログを通知できます。
* **DRY_RUNモード:** 実際の変更を適用せず、動作確認が可能です。
* **無限ループ防止:** ボットが作成した予定を識別し、ループを防ぎます。

## 🛠 セットアップ

### 1. プロジェクトの作成
Google Apps Script プロジェクトを新規作成するか、`clasp` でローカルに clone してください。

### 2. コードのデプロイ
`Code.js` の内容をコピー＆ペーストするか、push してください。

### 3. スクリプトプロパティの設定
GASエディタの「プロジェクトの設定」>「スクリプト プロパティ」に以下を設定します。

#### 必須プロパティ

| プロパティ名 | 説明 | 例 |
| --- | --- | --- |
| `WORK_CALENDAR_ID` | 仕事のカレンダーID | `user@company.com` |
| `HOME_CALENDAR_ID` | 家庭のカレンダーID | `user@gmail.com` |

#### オプションプロパティ

| プロパティ名 | 説明 | デフォルト値 |
| --- | --- | --- |
| `DISCORD_WEBHOOK_URL` | Discord通知用Webhook URL | (空) |
| `GOOGLE_CHAT_WEBHOOK_URL` | Google Chat通知用Webhook URL | (空) |
| `TAG_TO_HOME` | Work→Home同期タグ | `[Home]` |
| `TAG_TO_WORK` | Home→Work同期タグ | `[Work]` |
| `MASK_TITLE` | Home→Work時の表示タイトル | `休暇` |
| `SYNC_DAYS` | 同期対象期間（日数） | `30` |
| `WEEKEND_DAYS` | 週末とみなす曜日（0=日, 6=土） | `0,6` |
| `HOLIDAY_IGNORE_LIST` | 祝日判定から除外するイベント | `節分,バレンタイン,雛祭り,母の日,父の日,七夕,ハロウィン,クリスマス` |
| `CUSTOM_HOLIDAY_KEYWORDS` | 職場独自の休日キーワード | `創立記念日` |
| `DRY_RUN` | テストモード（true で変更を適用しない） | `false` |

### 4. トリガー設定
GASのトリガー設定画面で、`main` 関数を「時間主導型（例: 1時間おき）」で設定してください。

## 📋 使い方

### 自動同期（デフォルト動作）

| ケース | 動作 |
|--------|------|
| Work: 土日・祝日の予定 | → Home（自動、そのまま表示） |
| Work: 職場独自休日の予定 | → Home（自動、そのまま表示） |
| Home: 平日の予定 | → Work（自動、「休暇」として表示） |

### タグによる手動制御

| ケース | 動作 |
|--------|------|
| Work: `[Home]` タグ付きの予定 | → Home（曜日に関わらず同期） |
| Home: `[Work]` タグ付きの予定 | → Work（曜日に関わらず同期、マスク） |

### DRY_RUNモード

初回セットアップ時や設定変更時は、`DRY_RUN=true` で動作確認することを推奨します。

```
[DRY_RUN] ✨ 新規作成予定: 会議 (01/15 10:00)
[DRY_RUN] 🗑️ 削除予定: 休暇 (01/20 00:00)
```

## ⚠️ 前提条件
* 接続したい2つのカレンダーアカウント間で、**相互に「予定の変更権限」** の共有設定が必要です。

## License
MIT


